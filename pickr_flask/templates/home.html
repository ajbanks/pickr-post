{% extends 'layout.html' %}

{% block css %}
<link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/home.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="body">
    <div class="sidebar sidebar_small">
        {% include 'navigation.html' %}
    </div>
    <div class="content content_large">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div class="message-modal">
                <button type="button" class="close clickable" data-dismiss="alert">&times;</button>
                {% for message in messages %}
                <p>{{ message }}</p>
                {% endfor %}
            </div>
            {% endif %}
        {% endwith %}
        <div class="container">
            <h1>Dashboard - Tweets & Trending Topics</h1>
            <h2>{{date}}</h2>
            <h2>Trending topics in your niches for the last 14 days and high engagement tweets for you to post</h2>
        </div>
        {% for topic in topics %}
        <div class="topic clickable" onclick="location.href='topic/{{topic.id}}'">
            <div class="topic">
                <h3>Trending Topic {{ loop.index }} ðŸ”¥: {{topic.name}}</h1>
                <p>Click to view topic details</p>
                <hr/>
                <p>{{topic.description if topic.description}}</p>
                

                <h2>Generated posts for you to Tweet</h2>
                
                <div class="container cards">               
                    {% for post in topic.generated_posts[:3] %}
                    
                    <div class="card">
                        <div class="author">@{{ current_user.username }}</div>
                        <div class="suggested-post">
                            <p spellcheck="false">
                                {{post.text}}
                            </p>
                        </div>

                        <div class="button">
                            <a class="twitter-share-button" href="https://twitter.com/intent/tweet?url=%00"
                                data-size="large" data-text="{{ post.text }}">
                                Tweet
                            </a>
                        </div>
                    </div>
                     
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
        {% if topics|length < 1 %} <div class="no_topics">
            <hr />
            <p>Your account is still being set up. Please check again in 24 hours and you will have access to your trending topics and generated posts!</p>
    </div>
    {% endif %}

</div>

{% endblock %}



{% block js %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));</script>
{% endblock %}
